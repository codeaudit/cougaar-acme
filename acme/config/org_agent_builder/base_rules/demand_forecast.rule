####################################################
# Rule to insert DemandForecastPlugin (Formerly LogProjectionPlugin)
#   at consumers.
#
#   For UA Org's, only create demand for BulkPOL.
#
#   Consumers:
#     - orgs which have equipment are considered potential consumers of Ammunition, BulkPOL, PackagedPOL,
#       and RepairParts (Consumable).
#     - orgs which have personnel are consumers of Subsistence
#
# plugin = org.cougaar.logistics.plugin.demand.DemandForecastPlugin(SUPPLY_TYPE=Ammunition,SUPPLY_PG_CLASS=AmmoConsumerPG)
# plugin = org.cougaar.logistics.plugin.demand.DemandForecastPlugin(SUPPLY_TYPE=BulkPOL,SUPPLY_PG_CLASS=FuelConsumerPG)
# plugin = org.cougaar.logistics.plugin.demand.DemandForecastPlugin(SUPPLY_TYPE=PackagedPOL,SUPPLY_PG_CLASS=PackagedPOLConsumerPG)
# plugin = org.cougaar.logistics.plugin.demand.DemandForecastPlugin(SUPPLY_TYPE=Consumable,SUPPLY_PG_CLASS=RepairPartConsumerPG)
# plugin = org.cougaar.logistics.plugin.demand.DemandForecastPlugin(SUPPLY_TYPE=Subsistence,SUPPLY_PG_CLASS=SubsistenceConsumerPG)

demand_forecast_plugin = "org.cougaar.logistics.plugin.demand.DemandForecastPlugin"

society.each_agent do |agent|
  if agent.get_facet(:has_equipment_assets)
    # Only add Ammo type for non-UA agents with equipment
    unless agent.get_facet(:is_ua)
      agent.add_component do |c| 
	c.classname = demand_forecast_plugin
	c.add_argument('SUPPLY_TYPE=Ammunition')
	c.add_argument('SUPPLY_PG_CLASS=AmmoConsumerPG')
      end 
    end
    # And the FSB / FuelWaterSupply UA agent does not get the Fuel plugin
    unless agent.has_facet? { |facet| facet[:role]=='FuelSupplyProvider' && (facet[:mechanism] == 'TruckScheduler') && agent.get_facet(:is_ua) }
      agent.add_component do |c|
	c.classname = demand_forecast_plugin
	c.add_argument('SUPPLY_TYPE=BulkPOL')
	unless agent.get_facet(:is_ua)	
	  c.add_argument('SUPPLY_PG_CLASS=FuelConsumerPG')
	else
	  c.add_argument('SUPPLY_PG_CLASS=com.bbn.fcss.ldm.asset.FuelConsumerPG')
	end
      end
    end
    # Only non-UA agents get the PackagedPOL
    unless agent.get_facet(:is_ua)
      agent.add_component do |c| 
	c.classname = demand_forecast_plugin
	c.add_argument('SUPPLY_TYPE=PackagedPOL')
	c.add_argument('SUPPLY_PG_CLASS=PackagedPOLConsumerPG')
      end
    end
    # Only non-UA agents get teh Consumable
    unless agent.get_facet(:is_ua)
      agent.add_component do |c| 
	c.classname = demand_forecast_plugin
	c.add_argument('SUPPLY_TYPE=Consumable')
	c.add_argument('SUPPLY_PG_CLASS=RepairPartConsumerPG')
      end
    end
  end
  if agent.get_facet(:has_personnel_assets)
    # Only non-UA agents with personnel assets Eat
    unless agent.get_facet(:is_ua)
      agent.add_component do |c| 
	c.classname = demand_forecast_plugin
	c.add_argument('SUPPLY_TYPE=Subsistence')
	c.add_argument('SUPPLY_PG_CLASS=SubsistenceConsumerPG')
      end
    end
  end
end
