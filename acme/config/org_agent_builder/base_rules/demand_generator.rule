####################################################
# Rule to insert DemandGeneratorPlugin (Formerly LogSupplyPlugin)
#
# plugin = org.cougaar.logistics.plugin.demand.DemandGeneratorPlugin(SUPPLY_TYPE=Ammunition)
# plugin = org.cougaar.logistics.plugin.demand.DemandGeneratorPlugin(SUPPLY_TYPE=BulkPOL)
# plugin = org.cougaar.logistics.plugin.demand.DemandGeneratorPlugin(SUPPLY_TYPE=PackagedPOL)
# plugin = org.cougaar.logistics.plugin.demand.DemandGeneratorPlugin(SUPPLY_TYPE=Consumable)
# plugin = org.cougaar.logistics.plugin.demand.DemandGeneratorPlugin(SUPPLY_TYPE=Subsistence)

# From Amy: The FCS DemandGenerator produces an entire days worth of tasks at midnight (24),
# rather than generating them as you cross the hour threshholds. This allows
# you to step a whole society forward by days, rather than hours.
demand_generator_plugin = "org.cougaar.logistics.plugin.demand.DemandGeneratorPlugin"
ua_demand_generator_plugin = "com.bbn.fcss.plugin.demand.FcsDemandGeneratorPlugin"

society.each_agent do |agent|
  if agent.get_facet(:has_equipment_assets) 
    # For UA agents
    if agent.get_facet(:is_ua)
      # That are not the FSB/FWS
      unless agent.has_facet? { |facet| facet[:role]=='FuelSupplyProvider' && (facet[:mechanism] == 'TruckScheduler') }
        agent.add_component do |c|
	  c.classname = ua_demand_generator_plugin
	  c.add_argument('SUPPLY_TYPE=BulkPOL')
	  c.add_argument('GENERATE_PERIOD=86400000')
	end
      end
    else
      # For all non-UA agents (still requiring has_equipment_assets)
      agent.add_component do |c| 
	c.classname = demand_generator_plugin
	c.add_argument('SUPPLY_TYPE=BulkPOL')
      end
      agent.add_component do |c| 
	c.classname = demand_generator_plugin
	c.add_argument('SUPPLY_TYPE=PackagedPOL')
      end
      agent.add_component do |c| 
	c.classname = demand_generator_plugin
	c.add_argument('SUPPLY_TYPE=Consumable')
      end
      agent.add_component do |c| 
	c.classname = demand_generator_plugin
	c.add_argument('SUPPLY_TYPE=Ammunition')
      end
    end
  end
  # Non UA agents with people eat
  if agent.get_facet(:has_personnel_assets)
    unless agent.get_facet(:is_ua)      
      agent.add_component do |c| 
	c.classname = demand_generator_plugin
	c.add_argument('SUPPLY_TYPE=Subsistence')
      end
    end
  end
end
