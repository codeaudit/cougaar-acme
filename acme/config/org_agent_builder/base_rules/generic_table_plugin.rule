####################################################
# Rule to insert.GenericTablePlugin everywhere, except in Transcom echelon_group
# Special Arguments at OSC (formerly IOC) and maybe 1-AD
# plugin = org.cougaar.mlm.plugin.generic.GenericTablePlugin(IOC_allocation_rules.xml)      At IOC
# plugin = org.cougaar.mlm.plugin.generic.GenericTablePlugin(1AD_allocation_rules.xml)      At 1AD: Just for obsolete construction thread
# plugin = org.cougaar.mlm.plugin.generic.GenericTablePlugin(default_allocation_rules.xml)  Elsewhere

generic_table_plugin = "org.cougaar.mlm.plugin.generic.GenericTablePlugin"

society.each_agent do |agent|
  unless agent.get_facet(:echelon_group) == "Transcom" #everywhere but transcom echelon
    agent.add_component do |c|
      c.classname = generic_table_plugin
      terminal_ammunition_packer = false
      ua_strat_trans_provider = false
      agent.each_facet(:role) do |facet|
        if facet[:role] == "AmmunitionProvider" && facet[:mechanism] == "TerminalAmmunitionPacker"
          terminal_ammunition_packer = true
        end
	# Find the StratTransProviders that might need to handle
	# Project tasks, ie in UA, the FSB
	if facet[:role] == "FuelSupplyProvider" && facet[:mechanism] == "TruckScheduler"
	  ua_strat_trans_provider = true
	end
      end
      if terminal_ammunition_packer    # Just for OSC (Formerly IOC)
        c.add_argument("IOC_allocation_rules.xml")
      elsif agent.get_facet(:is_ua) && ua_strat_trans_provider
	# UA Trans plugins cant handle Project tasks. So make the FSB
	# which handles StratTrans use the rules here to handle them
	c.add_argument("dp_allocation_rules.xml")
      else
        c.add_argument("default_allocation_rules.xml")
      end
    end
  end
end
